# –†—ñ—à–µ–Ω–Ω—è –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è —á–∞—Ç—ñ–≤ –∑ Irys

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–î–∞–Ω—ñ –Ω–∞ Irys —î –Ω–µ–∑–º—ñ–Ω–Ω–∏–º–∏ (immutable), —Ç–æ–º—É —Ñ—ñ–∑–∏—á–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–µ–º–æ–∂–ª–∏–≤–µ. –ü–æ—Ç—Ä—ñ–±–Ω–æ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ "–º'—è–∫–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è" (soft delete).

## üí° –†—ñ—à–µ–Ω–Ω—è: –ú'—è–∫–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è

### –ö–æ–Ω—Ü–µ–ø—Ü—ñ—è
1. **–î–æ–¥–∞—Ç–∏ –ø–æ–ª–µ `isDeleted`** –¥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —á–∞—Ç—É
2. **–ó–±–µ—Ä—ñ–≥–∞—Ç–∏ "–≤–∏–¥–∞–ª–µ–Ω–∏–π" —Å—Ç–∞–Ω** —è–∫ –Ω–æ–≤–∏–π –∑–∞–ø–∏—Å –Ω–∞ Irys
3. **–§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω—ñ —á–∞—Ç–∏** –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
4. **–ó–±–µ—Ä—ñ–≥–∞—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω** –¥–ª—è –º–∏—Ç—Ç—î–≤–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è

### –ü–µ—Ä–µ–≤–∞–≥–∏
- ‚úÖ –ú–∏—Ç—Ç—î–≤–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –≤ UI
- ‚úÖ –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è
- ‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó
- ‚úÖ –°—É–º—ñ—Å–Ω—ñ—Å—Ç—å –∑ Irys

## üîß –¢–µ—Ö–Ω—ñ—á–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è

### 1. –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö

```typescript
interface ChatSession {
  id: string
  title: string
  createdAt: Date
  lastMessage?: string
  messages: Message[]
  isDeleted?: boolean  // –ù–æ–≤–µ –ø–æ–ª–µ
  deletedAt?: Date     // –î–∞—Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
}
```

### 2. –ù–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è

```typescript
const deleteChatSession = useCallback(async (chatId: string) => {
  // 1. –ú–∏—Ç—Ç—î–≤–æ –≤–∏–¥–∞–ª–∏—Ç–∏ –∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞–Ω—É
  setChatSessions(prev => prev.filter(chat => chat.id !== chatId))
  
  // 2. –ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ –Ω–∞ —ñ–Ω—à–∏–π —á–∞—Ç —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
  if (currentChatId === chatId) {
    const remainingChats = chatSessions.filter(chat => chat.id !== chatId)
    setCurrentChatId(remainingChats.length > 0 ? remainingChats[0].id : null)
  }
  
  // 3. –ó–±–µ—Ä–µ–≥—Ç–∏ "–≤–∏–¥–∞–ª–µ–Ω–∏–π" —Å—Ç–∞–Ω –Ω–∞ Irys
  if (address) {
    try {
      const deletedChat = chatSessions.find(chat => chat.id === chatId)
      if (deletedChat) {
        await saveChatToIrys(chatId, deletedChat.messages, true) // isDeleted = true
      }
    } catch (error) {
      console.error('Failed to save deletion state to Irys:', error)
    }
  }
}, [currentChatId, chatSessions, address, saveChatToIrys])
```

### 3. –û–Ω–æ–≤–ª–µ–Ω–Ω—è API –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è

–î–æ–¥–∞—Ç–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫—É –ø–æ–ª—è `isDeleted` –≤ `/api/save-chat`:

```typescript
interface ChatData {
  chatId: string
  title: string
  messages: Message[]
  userAddress: string
  createdAt: string
  updatedAt: string
  isDeleted?: boolean    // –ù–æ–≤–µ –ø–æ–ª–µ
  deletedAt?: string     // –î–∞—Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
}
```

### 4. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

–§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω—ñ —á–∞—Ç–∏ –≤ `/api/load-chats`:

```typescript
// –ì—Ä—É–ø—É–≤–∞—Ç–∏ –∑–∞ Chat-ID —Ç–∞ –≤–∑—è—Ç–∏ –Ω–∞–π–Ω–æ–≤—ñ—à—É –≤–µ—Ä—Å—ñ—é
const latestChats = chats.filter(chat => !chat.isDeleted)
```

### 5. –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ç–µ–≥–∏ –¥–ª—è Irys

```typescript
const tags = [
  // ... —ñ—Å–Ω—É—é—á—ñ —Ç–µ–≥–∏
  { name: 'Is-Deleted', value: isDeleted ? 'true' : 'false' },
  { name: 'Deleted-At', value: isDeleted ? new Date().toISOString() : '' }
]
```

## üé® UI –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

### –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è
```typescript
const handleDelete = (chatId: string) => {
  if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —á–∞—Ç?')) {
    deleteChatSession(chatId)
  }
}
```

### –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
- –î–æ–¥–∞—Ç–∏ —Ä–æ–∑–¥—ñ–ª "–í–∏–¥–∞–ª–µ–Ω—ñ —á–∞—Ç–∏"
- –§—É–Ω–∫—Ü—ñ—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑ `isDeleted: false`

## üìã –ü–ª–∞–Ω –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è

### –ö—Ä–æ–∫ 1: –û–Ω–æ–≤–∏—Ç–∏ —Ç–∏–ø–∏ —Ç–∞ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏
- [ ] –î–æ–¥–∞—Ç–∏ `isDeleted` —Ç–∞ `deletedAt` –¥–æ `ChatSession`
- [ ] –û–Ω–æ–≤–∏—Ç–∏ `ChatData` —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –ö—Ä–æ–∫ 2: –û–Ω–æ–≤–∏—Ç–∏ API
- [ ] –ú–æ–¥–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ `/api/save-chat` –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
- [ ] –û–Ω–æ–≤–∏—Ç–∏ `/api/load-chats` –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó

### –ö—Ä–æ–∫ 3: –û–Ω–æ–≤–∏—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç
- [ ] –ú–æ–¥–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ `deleteChatSession` —Ñ—É–Ω–∫—Ü—ñ—é
- [ ] –û–Ω–æ–≤–∏—Ç–∏ `saveChatToIrys` –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ `isDeleted`

### –ö—Ä–æ–∫ 4: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ—Å—Ç –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è —á–∞—Ç—ñ–≤
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
- [ ] –¢–µ—Å—Ç –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è (—è–∫—â–æ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ)

## üîç –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ñ —Ä—ñ—à–µ–Ω–Ω—è

### 1. –õ–æ–∫–∞–ª—å–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
- –í–∏–¥–∞–ª—è—Ç–∏ —Ç—ñ–ª—å–∫–∏ –∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞–Ω—É
- –ù–µ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —Å—Ç–∞–Ω –≤–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–∞ Irys
- ‚ùå –ß–∞—Ç–∏ –ø–æ–≤–µ—Ä–Ω—É—Ç—å—Å—è –ø—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

### 2. –ü—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ —Ç–µ–≥–∏
- –î–æ–¥–∞–≤–∞—Ç–∏ —Ç–µ–≥ `Hidden: true` –¥–æ —ñ—Å–Ω—É—é—á–∏—Ö –∑–∞–ø–∏—Å—ñ–≤
- ‚ùå –ù–µ–º–æ–∂–ª–∏–≤–æ —á–µ—Ä–µ–∑ –Ω–µ–∑–º—ñ–Ω–Ω—ñ—Å—Ç—å Irys

### 3. –û–∫—Ä–µ–º–∏–π —Ä–µ—î—Å—Ç—Ä –≤–∏–¥–∞–ª–µ–Ω–∏—Ö
- –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –≤–∏–¥–∞–ª–µ–Ω–∏—Ö ID –æ–∫—Ä–µ–º–æ
- ‚úÖ –ü—Ä–æ—Å—Ç—ñ—à–µ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏
- ‚ùå –ú–µ–Ω—à –Ω–∞–¥—ñ–π–Ω–æ

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è

**–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –º'—è–∫–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è** –∑ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º —Å—Ç–∞–Ω—É –Ω–∞ Irys —è–∫ –Ω–∞–π–±—ñ–ª—å—à –Ω–∞–¥—ñ–π–Ω–µ —Ç–∞ –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è.

–¶–µ –∑–∞–±–µ–∑–ø–µ—á—É—î:
- –ú–∏—Ç—Ç—î–≤—É —Ä–µ–∞–∫—Ü—ñ—é UI
- –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö
- –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è
- –°—É–º—ñ—Å–Ω—ñ—Å—Ç—å –∑ –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–æ—é –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–æ—é