# –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º–∏ –∞–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—ñ —á–∞—Ç—ñ–≤

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—ñ –º—ñ–∂ —á–∞—Ç–∞–º–∏ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞–ª–∞ —á–∞—Ç–∏ –Ω–∞ Irys, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –Ω–µ –±—É–ª–æ –Ω–æ–≤–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –≤—ñ–¥ AI. –¶–µ –ø—Ä–∏–∑–≤–æ–¥–∏–ª–æ –¥–æ:
- –ù–µ–ø–æ—Ç—Ä—ñ–±–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ Irys
- –ó–∞–π–≤–∏—Ö –≤–∏—Ç—Ä–∞—Ç –Ω–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
- –î—É–±–ª—é–≤–∞–Ω–Ω—è —á–∞—Ç—ñ–≤ –≤ —Å–∏—Å—Ç–µ–º—ñ
- –ü–æ–≥—ñ—Ä—à–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

## üîç –ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∏

–í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ `chat-interface.tsx` –±—É–≤ `useEffect` —Ö—É–∫, —è–∫–∏–π —Å–ø—Ä–∞—Ü—å–æ–≤—É–≤–∞–≤ –ø—Ä–∏ –∑–º—ñ–Ω—ñ:
- `messages` - –º–∞—Å–∏–≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- `currentChatId` - ID –ø–æ—Ç–æ—á–Ω–æ–≥–æ —á–∞—Ç—É
- `isLoading` - —Å—Ç–∞–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
- `address` - –∞–¥—Ä–µ—Å–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

–ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—ñ –º—ñ–∂ —á–∞—Ç–∞–º–∏ –∑–º—ñ–Ω—é–≤–∞–ª–∏—Å—è `currentChatId` —Ç–∞ `messages`, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏–ª–æ –¥–æ —Å–ø—Ä–∞—Ü—å–æ–≤—É–≤–∞–Ω–Ω—è –ª–æ–≥—ñ–∫–∏ –∞–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è.

## ‚úÖ –†—ñ—à–µ–Ω–Ω—è

–î–æ–¥–∞–Ω–æ –¥–æ–¥–∞—Ç–∫–æ–≤—É –ª–æ–≥—ñ–∫—É –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å:

### 1. –î–æ–¥–∞–Ω–æ ref –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
```javascript
const lastSavedMessageCountRef = useRef<number>(0)
```

### 2. –ú–æ–¥–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ —É–º–æ–≤—É –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
```javascript
// –¢—ñ–ª—å–∫–∏ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏, —è–∫—â–æ —î –Ω–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è —á–∞—Ç—ñ–≤)
if (messages.length > lastSavedMessageCountRef.current) {
  // –ó–±–µ—Ä–µ–≥—Ç–∏ –Ω–∞ Irys –ø—ñ—Å–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ AI
  const timeoutId = setTimeout(() => {
    saveChatToIrys(currentChatId, messages)
    lastSavedMessageCountRef.current = messages.length
  }, 1000)
  return () => clearTimeout(timeoutId)
}
```

### 3. –î–æ–¥–∞–Ω–æ —Å–∫–∏–¥–∞–Ω–Ω—è –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—ñ —á–∞—Ç—ñ–≤
```javascript
// –°–∫–∏–Ω—É—Ç–∏ –ª—ñ—á–∏–ª—å–Ω–∏–∫ –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—ñ —á–∞—Ç—ñ–≤
useEffect(() => {
  lastSavedMessageCountRef.current = 0
}, [currentChatId])
```

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–°—Ç–≤–æ—Ä–µ–Ω–æ —Ç–µ—Å—Ç `test-chat-switching.js` —è–∫–∏–π:
1. ‚úÖ –û—Ç—Ä–∏–º—É—î –ø–æ—á–∞—Ç–∫–æ–≤—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å —á–∞—Ç—ñ–≤ (17)
2. ‚úÖ –°—Ç–≤–æ—Ä—é—î –Ω–æ–≤–∏–π —Ç–µ—Å—Ç–æ–≤–∏–π —á–∞—Ç
3. ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä—è—î –ø–æ—è–≤—É –Ω–æ–≤–æ–≥–æ —á–∞—Ç—É (18 —á–∞—Ç—ñ–≤)
4. ‚úÖ –°–∏–º—É–ª—é—î 5 –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω—å –º—ñ–∂ —á–∞—Ç–∞–º–∏
5. ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä—è—î, —â–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —á–∞—Ç—ñ–≤ –Ω–µ –∑–º—ñ–Ω–∏–ª–∞—Å—è (–∑–∞–ª–∏—à–∏–ª–æ—Å—è 18)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** üéâ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù–û –£–°–ü–Ü–®–ù–û!

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

### –î–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:
- ‚ùå –ß–∞—Ç–∏ –∑–±–µ—Ä—ñ–≥–∞–ª–∏—Å—è –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—ñ
- ‚ùå –ù–µ–ø–æ—Ç—Ä—ñ–±–Ω—ñ –∑–∞–ø–∏—Ç–∏ –¥–æ Irys
- ‚ùå –ó–∞–π–≤—ñ –≤–∏—Ç—Ä–∞—Ç–∏ –Ω–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
- ‚ùå –ú–æ–∂–ª–∏–≤–µ –¥—É–±–ª—é–≤–∞–Ω–Ω—è —á–∞—Ç—ñ–≤

### –ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:
- ‚úÖ –ß–∞—Ç–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è –Ω–æ–≤–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π AI
- ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è –º—ñ–∂ —á–∞—Ç–∞–º–∏ –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
- ‚úÖ –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Irys
- ‚úÖ –£—Å—É–Ω–µ–Ω–æ –Ω–µ–ø–æ—Ç—Ä—ñ–±–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏

## üîß –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

### –§–∞–π–ª–∏, —â–æ –±—É–ª–∏ –∑–º—ñ–Ω–µ–Ω—ñ:
- `src/components/chat-interface.tsx` - –¥–æ–¥–∞–Ω–æ –ª–æ–≥—ñ–∫—É –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

### –ù–æ–≤—ñ —Ç–µ—Å—Ç–æ–≤—ñ —Ñ–∞–π–ª–∏:
- `test-chat-switching.js` - —Ç–µ—Å—Ç –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

### –õ–æ–≥—ñ–∫–∞ —Ä–æ–±–æ—Ç–∏:
1. –ü—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —á–∞—Ç—É `lastSavedMessageCountRef` —Å–∫–∏–¥–∞—î—Ç—å—Å—è –¥–æ 0
2. –ü—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –Ω–æ–≤–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è, —á–∏ –±—ñ–ª—å—à–∞ –ø–æ—Ç–æ—á–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞ –∑–±–µ—Ä–µ–∂–µ–Ω—É
3. –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —î –Ω–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
4. –ü—ñ—Å–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ª—ñ—á–∏–ª—å–Ω–∏–∫ –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

## üéØ –í–∏—Å–Ω–æ–≤–æ–∫

–ü—Ä–æ–±–ª–µ–º–∞ –∞–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—ñ —á–∞—Ç—ñ–≤ —É—Å–ø—ñ—à–Ω–æ –≤–∏—Ä—ñ—à–µ–Ω–∞. –¢–µ–ø–µ—Ä —Å–∏—Å—Ç–µ–º–∞:
- –ó–±–µ—Ä—ñ–≥–∞—î —á–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ —Ü–µ –¥—ñ–π—Å–Ω–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
- –ù–µ –≤–∏—Ç—Ä–∞—á–∞—î —Ä–µ—Å—É—Ä—Å–∏ –Ω–∞ –Ω–µ–ø–æ—Ç—Ä—ñ–±–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
- –ü—Ä–∞—Ü—é—î –±—ñ–ª—å—à –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ç–∞ –µ–∫–æ–Ω–æ–º–Ω–æ
- –ó–∞–±–µ–∑–ø–µ—á—É—î –∫—Ä–∞—â–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–π –¥–æ—Å–≤—ñ–¥